{% extends "base.html" %}
{% block title %}
    Admin Dashboard - TUSOME
{% endblock
%}
<link rel="stylesheet"
      href="{{ url_for('static',filename='bootstrap.min.css') }}" />
<link rel="stylesheet"
      href="{{ url_for('static',filename='tom-select.css') }}" />
{% block extra_css %}
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --info-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --danger-gradient: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            --dark-gradient: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        }

        .dashboard-header {
            background: var(--primary-gradient);
            color: white;
            padding: 2rem 0;
            margin: -1.5rem -15px 2rem -15px;
            border-radius: 0 0 20px 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .container {
            display: flex;
            justify-content: center;
            margin-bottom: 3px;
        }

        .logo-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .logo-container img {
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .welcome-text {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .stats-card {
            border: none;
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .stats-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }

        .stats-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg,
                    rgba(255, 255, 255, 0.3),
                    rgba(255, 255, 255, 0.7),
                    rgba(255, 255, 255, 0.3));
        }

        .stats-card.primary {
            background: var(--primary-gradient);
        }

        .stats-card.success {
            background: var(--success-gradient);
        }

        .stats-card.info {
            background: var(--info-gradient);
        }

        .stats-card.danger {
            background: var(--danger-gradient);
        }

        .stats-number {
            font-size: 2.5rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .stats-label {
            font-size: 0.9rem;
            opacity: 0.9;
            font-weight: 500;
        }

        .stats-icon {
            opacity: 0.8;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        }

        .action-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }

        .action-card:hover {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .action-btn {
            border-radius: 12px;
            padding: 0.75rem 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                    transparent,
                    rgba(255, 255, 255, 0.2),
                    transparent);
            transition: left 0.5s;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .chart-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }

        .chart-card:hover {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .chart-card .card-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            border-radius: 15px 15px 0 0 !important;
        }

        .data-table {
            border-radius: 10px;
            overflow: hidden;
        }

        .data-table th {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            border: none;
            font-weight: 600;
            padding: 1rem 0.75rem;
        }

        .data-table td {
            padding: 0.75rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            vertical-align: middle;
        }

        .data-table tbody tr:hover {
            background-color: rgba(0, 123, 255, 0.05);
            transform: scale(1.01);
            transition: all 0.2s ease;
        }

        .grade-badge {
            padding: 0.5rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .grade-A {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .grade-B {
            background: linear-gradient(135deg, #17a2b8, #6f42c1);
            color: white;
        }

        .grade-C {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
            color: white;
        }

        .grade-D {
            background: linear-gradient(135deg, #dc3545, #e83e8c);
            color: white;
        }

        .announcement-card {
            border: none;
            border-radius: 15px;
            margin-bottom: 1rem;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .announcement-card::before {
            content: "";
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 5px;
            background: var(--primary-gradient);
        }

        .announcement-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.15);
        }

        .priority-badge {
            border-radius: 20px;
            padding: 0.3rem 0.8rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .floating-action {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        .fab {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary-gradient);
            border: none;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .fab:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-in-left {
            animation: slideInLeft 0.6s ease-out;
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .slide-in-right {
            animation: slideInRight 0.6s ease-out;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(50px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
    </style>
{% endblock %}
{% block content %}
    <!-- Enhanced Header Section -->
    <div class="dashboard-header fade-in">
        <div class="container">
            <div class="d-flex justify-content-center mb-3">
                <div class="logo-container">
                    {% if school.logo_url %}
                        <img src="{{ url_for('static', filename=school.logo_url) }}"
                             alt="{{ school.name }} Logo"
                             height="80" />
                    {% else %}
                        <div class="text-center p-3">
                            <i class="fas fa-school fa-3x mb-2"></i>
                            <p class="mb-0">{{ school.name if school else "School Info Not Set" }}</p>
                        </div>
                    {% endif %}
                </div>
            </div>
            <div class="text-center">
                <h1 class="mb-2">
                    <i class="fas fa-tachometer-alt me-2"></i>
                    Admin Dashboard
                </h1>
                <p class="welcome-text mb-0">
                    <i class="fas fa-user-shield me-1"></i>
                    Welcome back, <strong>{{ current_user.full_name }}</strong>
                </p>
            </div>
        </div>
    </div>
    <!-- Enhanced Stats Cards -->
    <div class="row mb-4 slide-in-left" id="stats">
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card stats-card primary text-white pulse">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="stats-number">{{ total_students }}</div>
                            <div class="stats-label">Total Students</div>
                            <small class="d-block mt-1">
                                <i class="fas fa-arrow-up me-1"></i>
                                +12% from last month
                            </small>
                        </div>
                        <div class="stats-icon">
                            <i class="fas fa-user-graduate fa-3x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card stats-card success text-white">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="stats-number">{{ total_parents }}</div>
                            <div class="stats-label">Total Parents</div>
                            <small class="d-block mt-1">
                                <i class="fas fa-arrow-up me-1"></i>
                                +8% from last month
                            </small>
                        </div>
                        <div class="stats-icon">
                            <i class="fas fa-users fa-3x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card stats-card info text-white">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="stats-number">{{ total_subjects }}</div>
                            <div class="stats-label">Total Subjects</div>
                            <small class="d-block mt-1">
                                <i class="fas fa-check me-1"></i>
                                All active
                            </small>
                        </div>
                        <div class="stats-icon">
                            <i class="fas fa-book fa-3x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card stats-card danger text-white">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="stats-number">{{ "{:,.0f}".format(total_fees_due/1000) }}K</div>
                            <div class="stats-label">Outstanding Fees</div>
                            <small class="d-block mt-1">
                                <i class="fas fa-exclamation-triangle me-1"></i>
                                Needs attention
                            </small>
                        </div>
                        <div class="stats-icon">
                            <i class="fas fa-money-bill-wave fa-3x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Enhanced Quick Actions -->
    <div class="row mb-4 slide-in-right">
        <div class="col-12">
            <div class="card action-card">
                <div class="card-header bg-gradient text-white"
                     style="background: var(--primary-gradient)">
                    <h5 class="mb-0">
                        <i class="fas fa-bolt me-2"></i>
                        Quick Actions
                    </h5>
                </div>
                <div class="card-body p-4">
                    <div class="row g-3">
                        <div class="col-lg-2 col-md-4 col-sm-6">
                            <a href="{{ url_for("admin_bp.add_student") }}"
                               class="btn btn-primary action-btn w-100">
                                <i class="fas fa-plus me-2"></i>
                                Add Student
                            </a>
                        </div>
                        <div class="col-lg-2 col-md-4 col-sm-6">
                            <a href="{{ url_for("admin_bp.add_user") }}"
                               class="btn btn-success action-btn w-100">
                                <i class="fas fa-user-plus me-2"></i>
                                Add User
                            </a>
                        </div>
                        <div class="col-lg-2 col-md-4 col-sm-6">
                            <a href="{{ url_for("grade_bp.add_grade") }}"
                               class="btn btn-info action-btn w-100">
                                <i class="fas fa-chart-line me-2"></i>
                                Add Grade
                            </a>
                        </div>
                        <div class="col-lg-2 col-md-4 col-sm-6">
                            <a href="{{ url_for("fee_bp.admin_add_payment") }}"
                               class="btn btn-warning action-btn w-100">
                                <i class="fas fa-credit-card me-2"></i>
                                Record Payment
                            </a>
                        </div>
                        <div class="col-lg-2 col-md-4 col-sm-6">
                            <a href="{{ url_for("admin_bp.announcements") }}"
                               class="btn btn-secondary action-btn w-100">
                                <i class="fas fa-bullhorn me-2"></i>
                                Announcement
                            </a>
                        </div>
                        <div class="col-lg-2 col-md-4 col-sm-6">
                            <a href="{{ url_for("bulk_bp.bulk_upload_view") }}"
                               class="btn btn-dark action-btn w-100">
                                <i class="fas fa-upload me-2"></i>
                                Bulk Entry
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Enhanced Charts Section -->
    <div class="row mb-4 fade-in">
        <div class="col-lg-6 mb-4">
            <div class="card chart-card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-pie me-2 text-primary"></i>
                        Class Distribution
                    </h5>
                </div>
                <div class="card-body">
                    <canvas id="classChart" height="300"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-6 mb-4">
            <div class="card chart-card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-money-bill-trend-up me-2 text-success"></i>
                        Fee Collection Overview
                    </h5>
                </div>
                <div class="card-body">
                    <canvas id="feeChart" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>
    <!-- Enhanced Data Tables -->
    <div class="row mb-4 slide-in-left">
        <div class="col-lg-6 mb-4">
            <div class="card chart-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-receipt me-2 text-success"></i>
                        Recent Payments
                    </h5>
                    <span class="badge bg-success">{{ recent_payments|length }} new</span>
                </div>
                <div class="card-body p-0">
                    {% if recent_payments %}
                        <div class="table-responsive">
                            <table class="table data-table mb-0">
                                <thead>
                                    <tr>
                                        <th>
                                            <i class="fas fa-user me-1"></i>Student
                                        </th>
                                        <th>
                                            <i class="fas fa-money-bill me-1"></i>Amount
                                        </th>
                                        <th>
                                            <i class="fas fa-calendar me-1"></i>Date
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for payment in recent_payments %}
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="avatar-sm bg-primary rounded-circle d-flex align-items-center justify-content-center me-2">
                                                        <i class="fas fa-user text-white"></i>
                                                    </div>
                                                    {{ payment.student.full_name }}
                                                </div>
                                            </td>
                                            <td>
                                                <span class="fw-bold text-success">KSh {{ "{:,.2f}".format(payment.amount_paid) }}</span>
                                            </td>
                                            <td>
                                                {{ payment.payment_date.strftime("%Y-%m-%d") 
                                                if payment.payment_date else 'N/A' }}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div class="card-footer text-center bg-light">
                            <a href="{{ url_for("payments") }}"
                               class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-eye me-1"></i>View All Payments
                            </a>
                        </div>
                    {% else %}
                        <div class="text-center p-4">
                            <i class="fas fa-receipt fa-3x text-muted mb-3"></i>
                            <p class="text-muted">No recent payments</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-lg-6 mb-4">
            <div class="card chart-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-user-graduate me-2 text-primary"></i>
                        Recently Added Students
                    </h5>
                    <span class="badge bg-primary">{{ recent_students|length }} new</span>
                </div>
                <div class="card-body p-0">
                    {% if recent_students %}
                        <div class="table-responsive">
                            <table class="table data-table mb-0">
                                <thead>
                                    <tr>
                                        <th>
                                            <i class="fas fa-id-card me-1"></i>Admission
                                            No.
                                        </th>
                                        <th>
                                            <i class="fas fa-user me-1"></i>Name
                                        </th>
                                        <th>
                                            <i class="fas fa-chalkboard me-1"></i>Class
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for student in recent_students %}
                                        <tr>
                                            <td>
                                                <span class="badge bg-secondary">{{ student.admission_number }}</span>
                                            </td>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="avatar-sm bg-info rounded-circle d-flex align-items-center justify-content-center me-2">
                                                        <i class="fas fa-user-graduate text-white"></i>
                                                    </div>
                                                    {{ student.full_name }}
                                                </div>
                                            </td>
                                            <td>
                                                <span class="badge bg-info">{{ student.current_class }}</span>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div class="card-footer text-center bg-light">
                            <a href="{{ url_for("admin_bp.manage_students") }}"
                               class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-eye me-1"></i>View All Students
                            </a>
                        </div>
                    {% else %}
                        <div class="text-center p-4">
                            <i class="fas fa-user-graduate fa-3x text-muted mb-3"></i>
                            <p class="text-muted">No recent students</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <!-- Enhanced Grades Section -->
    <div class="row mb-4 slide-in-right">
        <div class="col-12">
            <div class="card chart-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-bar me-2 text-warning"></i>
                        Recent Grade Entries
                    </h5>
                    <div>
                        <span class="badge bg-warning me-2">{{ recent_grades|length }} entries</span>
                        <button class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-download me-1"></i>Export
                        </button>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table data-table mb-0">
                            <thead>
                                <tr>
                                    <th>
                                        <i class="fas fa-user me-1"></i>Student
                                    </th>
                                    <th>
                                        <i class="fas fa-book me-1"></i>Subject
                                    </th>
                                    <th>
                                        <i class="fas fa-calendar-alt me-1"></i>Term
                                    </th>
                                    <th>
                                        <i class="fas fa-percentage me-1"></i>Marks
                                    </th>
                                    <th>
                                        <i class="fas fa-medal me-1"></i>Grade
                                    </th>
                                    <th>
                                        <i class="fas fa-clock me-1"></i>Date Added
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for grade in recent_grades %}
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="avatar-sm bg-warning rounded-circle d-flex align-items-center justify-content-center me-2">
                                                    <i class="fas fa-user text-white"></i>
                                                </div>
                                                {{ grade.student.full_name }}
                                            </div>
                                        </td>
                                        <td>
                                            <span class="badge bg-light text-dark">{{ grade.subject.name }}</span>
                                        </td>
                                        <td>{{ grade.term }} {{ grade.year }}</td>
                                        <td>
                                            <div class="progress" style="height: 20px">
                                                {% set max_marks = 100 %}
                                                <div class="progress-bar bg-success"
                                                     role="progressbar"
                                                     style="width: {{ (grade.marks / max_marks * 100) | round }}%">
                                                    {{ grade.marks }}/{{ grade.marks }}
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="grade-badge grade-{{ grade.grade_letter }}">{{ grade.grade_letter }}</span>
                                        </td>
                                        <td>
                                            <small class="text-muted">
                                                {{ grade.created_at.strftime('%Y-%m-%d
                                                                                                %H:%M') }}
                                            </small>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Enhanced Announcements -->
    <div class="row mb-4 fade-in">
        <div class="col-12">
            <div class="card chart-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-bullhorn me-2 text-info"></i>
                        School Announcements
                    </h5>
                    <button class="btn btn-primary btn-sm"
                            onclick="location.href='{{ url_for("admin_bp.add_announcement") }}'">
                        <i class="fas fa-plus me-1"></i>New Announcement
                    </button>
                </div>
                <div class="card-body">
                    {% for announcement in active_announcements %}
                        <div class="announcement-card alert alert-{{ 'danger' if announcement.priority == 'urgent' else 'warning' if announcement.priority == 'high' else 'info' }} mb-3">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-{{ 'exclamation-triangle' if announcement.priority == 'urgent' else 'info-circle' }} me-2"></i>
                                        <h6 class="mb-0 fw-bold">{{ announcement.title }}</h6>
                                    </div>
                                    <p class="mb-2">{{ announcement.content }}</p>
                                    <div class="d-flex align-items-center text-muted">
                                        <small class="me-3">
                                            <i class="fas fa-users me-1"></i>
                                            Target: {{ announcement.target_audience.title() }}
                                        </small>
                                        <small>
                                            <i class="fas fa-clock me-1"></i>
                                            {{ announcement.created_at.strftime('%Y-%m-%d
                                                                                        %H:%M') }}
                                        </small>
                                    </div>
                                </div>
                                <div class="ms-3">
                                    <span class="priority-badge bg-{{ 'danger' if announcement.priority == 'urgent' else 'warning' if announcement.priority == 'high' else 'primary' }}">
                                        {{ announcement.priority.title() }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <div class="text-center p-4">
                            <i class="fas fa-bullhorn fa-3x text-muted mb-3"></i>
                            <p class="text-muted">No active announcements</p>
                            <button class="btn btn-primary"
                                    onclick="location.href='{{ url_for("admin_bp.add_announcement") }}'">
                                <i class="fas fa-plus me-1"></i>Create First
                                Announcement
                            </button>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    <!-- Floating Action Button -->
    <div class="floating-action">
        <button class="fab"
                data-bs-toggle="modal"
                data-bs-target="#quickActionsModal"
                title="Quick Actions">
            <i class="fas fa-plus"></i>
        </button>
    </div>
    <!-- Quick Actions Modal -->
    <div class="modal fade" id="quickActionsModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"
                     style="background: var(--primary-gradient);
                            color: white">
                    <h5 class="modal-title">
                        <i class="fas fa-bolt me-2"></i>Quick Actions
                    </h5>
                    <button type="button"
                            class="btn-close btn-close-white"
                            data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-6">
                            <a href="{{ url_for("admin_bp.add_student") }}"
                               class="btn btn-outline-primary w-100 p-3">
                                <i class="fas fa-user-plus fa-2x d-block mb-2"></i>
                                Add Student
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="{{ url_for("fee_bp.make_payment") }}"
                               class="btn btn-outline-success w-100 p-3">
                                <i class="fas fa-credit-card fa-2x d-block mb-2"></i>
                                Record Payment
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="{{ url_for("grade_bp.add_grade") }}"
                               class="btn btn-outline-info w-100 p-3">
                                <i class="fas fa-chart-line fa-2x d-block mb-2"></i>
                                Add Grade
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="{{ url_for("admin_bp.add_announcement") }}"
                               class="btn btn-outline-warning w-100 p-3">
                                <i class="fas fa-bullhorn fa-2x d-block mb-2"></i>
                                Announcement
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block extra_js %}
    <script src="{{ url_for('static',filename='bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static',filename= 'chart.js') }}"></script>
    <!--<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>-->
    <script>
        // Enhanced animations and interactions
        document.addEventListener('DOMContentLoaded', function() {
            // Add loading animation to stats cards
            const statsCards = document.querySelectorAll('.stats-card');
            statsCards.forEach((card, index) => {
                setTimeout(() => {
                    card.style.opacity = '0';
                    card.style.transform = 'translateY(20px)';
                    card.style.transition = 'all 0.6s ease';

                    setTimeout(() => {
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0)';
                    }, 100);
                }, index * 150);
            });

            // Add hover effects to action buttons
            const actionBtns = document.querySelectorAll('.action-btn');
            actionBtns.forEach(btn => {
                btn.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-3px) scale(1.02)';
                });

                btn.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0) scale(1)';
                });
            });

            // Add click ripple effect
            function createRipple(event) {
                const button = event.currentTarget;
                const circle = document.createElement("span");
                const diameter = Math.max(button.clientWidth, button.clientHeight);
                const radius = diameter / 2;

                circle.style.width = circle.style.height = `${diameter}px`;
                circle.style.left = `${event.clientX - button.offsetLeft - radius}px`;
                circle.style.top = `${event.clientY - button.offsetTop - radius}px`;
                circle.classList.add("ripple");

                const ripple = button.getElementsByClassName("ripple")[0];
                if (ripple) {
                    ripple.remove();
                }

                button.appendChild(circle);
            }

            // Add ripple effect to buttons
            document.querySelectorAll('.action-btn, .fab').forEach(btn => {
                btn.addEventListener('click', createRipple);
            });

            // Auto-refresh stats every 30 seconds
            setInterval(() => {
                // Add subtle pulse animation to indicate data refresh
                statsCards.forEach(card => {
                    card.classList.add('pulse');
                    setTimeout(() => card.classList.remove('pulse'), 1000);
                });
            }, 30000);
        });

        // Enhanced Class Distribution Chart
        const classCtx = document.getElementById('classChart').getContext('2d');
        const classChart = new Chart(classCtx, {
            type: 'doughnut',
            data: {
                labels: [{
                        %
                        for class_data in class_distribution %
                    }
                    '{{ class_data[0] }}' {
                        {
                            ','
                            if not loop.last
                        }
                    } {
                        % endfor %
                    }
                ],
                datasets: [{
                    data: [{
                        %
                        for class_data in class_distribution %
                    } {
                        {
                            class_data[1]
                        }
                    } {
                        {
                            ','
                            if not loop.last
                        }
                    } {
                        % endfor %
                    }],
                    backgroundColor: [
                        'rgba(102, 126, 234, 0.8)',
                        'rgba(118, 75, 162, 0.8)',
                        'rgba(255, 154, 158, 0.8)',
                        'rgba(255, 206, 84, 0.8)',
                        'rgba(75, 192, 192, 0.8)',
                        'rgba(153, 102, 255, 0.8)',
                        'rgba(255, 159, 64, 0.8)',
                        'rgba(199, 199, 199, 0.8)'
                    ],
                    borderColor: [
                        'rgba(102, 126, 234, 1)',
                        'rgba(118, 75, 162, 1)',
                        'rgba(255, 154, 158, 1)',
                        'rgba(255, 206, 84, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)',
                        'rgba(199, 199, 199, 1)'
                    ],
                    borderWidth: 3,
                    hoverBorderWidth: 5,
                    hoverOffset: 10
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            usePointStyle: true,
                            font: {
                                size: 12,
                                weight: '600'
                            }
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleColor: 'white',
                        bodyColor: 'white',
                        borderColor: 'rgba(255, 255, 255, 0.2)',
                        borderWidth: 1,
                        cornerRadius: 10,
                        displayColors: true,
                        callbacks: {
                            label: function(context) {
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = ((context.parsed * 100) / total).toFixed(1);
                                return `${context.label}: ${context.parsed} students (${percentage}%)`;
                            }
                        }
                    }
                },
                animation: {
                    animateRotate: true,
                    animateScale: true,
                    duration: 2000,
                    easing: 'easeOutQuart'
                },
                interaction: {
                    intersect: false,
                    mode: 'index'
                }
            }
        });

        // Enhanced Fee Collection Chart
        const feeCtx = document.getElementById('feeChart').getContext('2d');
        const feeChart = new Chart(feeCtx, {
            type: 'bar',
            data: {
                labels: ['Fees Collected', 'Outstanding Fees'],
                datasets: [{
                    label: 'Amount (KES)',
                    data: [{
                        {
                            total_fees_paid
                        }
                    }, {
                        {
                            total_fees_due
                        }
                    }],
                    backgroundColor: [
                        'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                        'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)'
                    ],
                    borderColor: [
                        'rgba(67, 233, 123, 1)',
                        'rgba(255, 154, 158, 1)'
                    ],
                    borderWidth: 2,
                    borderRadius: 10,
                    borderSkipped: false,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleColor: 'white',
                        bodyColor: 'white',
                        borderColor: 'rgba(255, 255, 255, 0.2)',
                        borderWidth: 1,
                        cornerRadius: 10,
                        callbacks: {
                            label: function(context) {
                                return `${context.label}: KES ${context.parsed.toLocaleString()}`;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)',
                            drawBorder: false
                        },
                        ticks: {
                            callback: function(value) {
                                return 'KES ' + (value / 1000).toFixed(0) + 'K';
                            },
                            font: {
                                size: 11,
                                weight: '600'
                            },
                            color: '#6c757d'
                        }
                    },
                    x: {
                        grid: {
                            display: false,
                            drawBorder: false
                        },
                        ticks: {
                            font: {
                                size: 12,
                                weight: '600'
                            },
                            color: '#495057'
                        }
                    }
                },
                animation: {
                    duration: 2000,
                    easing: 'easeOutQuart'
                },
                interaction: {
                    intersect: false,
                    mode: 'index'
                }
            }
        });

        // Add CSS for ripple effect
        const style = document.createElement('style');
        style.textContent = `
	    .ripple {
	        position: absolute;
	        border-radius: 50%;
	        transform: scale(0);
	        animation: ripple 600ms linear;
	        background-color: rgba(255, 255, 255, 0.6);
	    }

	    @keyframes ripple {
	        to {
	            transform: scale(4);
	            opacity: 0;
	        }
	    }

	    .avatar-sm {
	        width: 32px;
	        height: 32px;
	        font-size: 0.75rem;
	    }

	    .progress {
	        background-color: rgba(0, 0, 0, 0.1);
	        border-radius: 10px;
	        overflow: hidden;
	    }

	    .progress-bar {
	        border-radius: 10px;
	        transition: width 0.6s ease;
	    }

	    /* Custom scrollbar for tables */
	    .table-responsive::-webkit-scrollbar {
	        height: 6px;
	    }

	    .table-responsive::-webkit-scrollbar-track {
	        background: #f1f1f1;
	        border-radius: 10px;
	    }

	    .table-responsive::-webkit-scrollbar-thumb {
	        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
	        border-radius: 10px;
	    }

	    .table-responsive::-webkit-scrollbar-thumb:hover {
	        background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
	    }

	    /* Enhanced card hover effects */
	    .chart-card:hover .card-header {
	        background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%) !important;
	        transition: all 0.3s ease;
	    }

	    /* Loading skeleton animation */
	    @keyframes skeleton-loading {
	        0% {
	            background-position: -200px 0;
	        }
	        100% {
	            background-position: calc(200px + 100%) 0;
	        }
	    }

	    .skeleton {
	        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
	        background-size: 200px 100%;
	        animation: skeleton-loading 1.5s infinite;
	    }

	    /* Mobile responsiveness improvements */
	    @media (max-width: 768px) {
	        .dashboard-header {
	            margin: -1rem -15px 1rem -15px;
	            padding: 1.5rem 0;
	        }

	        .stats-number {
	            font-size: 2rem;
	        }

	        .floating-action {
	            bottom: 20px;
	            right: 20px;
	        }

	        .fab {
	            width: 50px;
	            height: 50px;
	            font-size: 1.2rem;
	        }

	        .action-btn {
	            padding: 0.5rem;
	            font-size: 0.85rem;
	        }
	    }

	    /* Dark mode support */
	    @media (prefers-color-scheme: dark) {
	        .chart-card .card-header {
	            background: linear-gradient(135deg, #343a40 0%, #495057 100%) !important;
	            color: white;
	        }

	        .data-table th {
	            background: linear-gradient(135deg, #495057 0%, #343a40 100%);
	        }
	    }
	`;
        document.head.appendChild(style);

        // Add real-time notifications (if WebSocket is available)
        if (typeof io !== 'undefined') {
            const socket = io();

            socket.on('new_payment', function(data) {
                // Show toast notification
                showToast('New Payment Received', `${data.student_name} paid KES ${data.amount}`, 'success');

                // Update stats if visible
                updateStatsCard('total_fees_paid', data.new_total);
            });

            socket.on('new_student', function(data) {
                showToast('New Student Added', `${data.student_name} has been enrolled`, 'info');
                updateStatsCard('total_students', data.new_total);
            });
        }

        // Toast notification function
        function showToast(title, message, type = 'info') {
            const toastContainer = document.getElementById('toast-container') || createToastContainer();

            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-white bg-${type} border-0 show`;
            toast.setAttribute('role', 'alert');
            toast.innerHTML = `
	        <div class="d-flex">
	            <div class="toast-body">
	                <strong>${title}</strong><br>
	                ${message}
	            </div>
	            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
	        </div>
	    `;

            toastContainer.appendChild(toast);

            // Auto remove after 5 seconds
            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        function createToastContainer() {
            const container = document.createElement('div');
            container.id = 'toast-container';
            container.className = 'toast-container position-fixed top-0 end-0 p-3';
            container.style.zIndex = '9999';
            document.body.appendChild(container);
            return container;
        }

        function updateStatsCard(cardType, newValue) {
            const card = document.querySelector(`[data-stat="${cardType}"] .stats-number`);
            if (card) {
                // Animate number change
                const currentValue = parseInt(card.textContent.replace(/[^\d]/g, ''));
                animateNumber(card, currentValue, newValue, 1000);

                // Add pulse effect
                card.closest('.stats-card').classList.add('pulse');
                setTimeout(() => {
                    card.closest('.stats-card').classList.remove('pulse');
                }, 1000);
            }
        }

        function animateNumber(element, start, end, duration) {
            const range = end - start;
            const increment = range / (duration / 16);
            let current = start;

            const timer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                    current = end;
                    clearInterval(timer);
                }
                element.textContent = Math.floor(current).toLocaleString();
            }, 16);
        }

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + Shift + S = Add Student
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'S') {
                e.preventDefault();
                window.location.href = "{{ url_for('admin_bp.add_student') }}";
            }

            // Ctrl/Cmd + Shift + P = Add Payment
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'P') {
                e.preventDefault();
                window.location.href = "{{ url_for('fee_bp.make_payment') }}";
            }

            // Ctrl/Cmd + Shift + G = Add Grade
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'G') {
                e.preventDefault();
                window.location.href = "{{ url_for('grade_bp.add_grade') }}";
            }
        });

        // Performance monitoring
        const observer = new PerformanceObserver((list) => {
            for (const entry of list.getEntries()) {
                if (entry.entryType === 'navigation') {
                    console.log(`Page load time: ${entry.loadEventEnd - entry.loadEventStart}ms`);
                }
            }
        });
        observer.observe({
            entryTypes: ['navigation']
        });

        // Add service worker for offline functionality (if available)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => console.log('SW registered'))
                .catch(error => console.log('SW registration failed'));
        }
    </script>
{% endblock %}
