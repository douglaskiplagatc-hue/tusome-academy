{% extends "base.html" %}

{% block title %}Salary Approvals{% endblock %}

{% block extra_css %}
<style>
.card { border-radius: 16px; box-shadow: 0 6px 20px rgba(0,0,0,.08); }
.table thead { background: #343a40; color: white; }
.table tbody tr:hover { background: #f8f9fa; }
.btn-approve { background: linear-gradient(135deg,#28a745,#20c997); color:white; transition:.25s ease; }
.btn-approve:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,.12); }

.kpi-card { border-radius: 18px; box-shadow: 0 8px 20px rgba(0,0,0,.12); color: white; text-align: center; transition: transform .25s ease; }
.kpi-card:hover { transform: translateY(-4px); }
.kpi-value { font-size: 2rem; font-weight: 700; }
.kpi-label { opacity: 0.85; font-size: 0.9rem; }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">

    <!-- KPI Summary -->
    <div class="row mb-4">
        <div class="col-md-4 mb-3">
            <div class="kpi-card bg-warning">
                <div class="kpi-value">{{ pending|length }}</div>
                <div class="kpi-label"><i class="fas fa-hourglass-half me-1"></i>Pending Approvals</div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="kpi-card bg-primary">
                <div class="kpi-value">KES {{ (total_pending_net or 0) | round(2) }}</div>
                <div class="kpi-label"><i class="fas fa-wallet me-1"></i>Total Net Pay</div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="kpi-card bg-info">
                <div class="kpi-value">{{ total_staff }}</div>
                <div class="kpi-label"><i class="fas fa-users me-1"></i>Total Staff</div>
            </div>
        </div>
    </div>

    <!-- Pending Salaries Table -->
    <div class="card mb-4">
        <div class="card-header bg-dark text-white">
            <h5 class="mb-0"><i class="fas fa-file-invoice-dollar me-2"></i>Pending Salary Approvals</h5>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-striped table-hover mb-0">
                    <thead class="table-dark">
                        <tr>
                            <th>Staff</th>
                            <th>Net Pay (KES)</th>
                            <th>Bank</th>
                            <th>Account Number</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for p in pending %}
                        <tr>
                            <td>{{ p.staff.full_name }}</td>
                            <td>{{ p.net_salary | round(2) }}</td>
                            <td>{{ p.bank_name }}</td>
                            <td>{{ p.account_number }}</td>
                            <td>
                                <form method="post" action="{{ url_for('finance_bp.approve_salary', payroll_id=p.id) }}">
                                    <button class="btn btn-approve btn-sm">
                                        <i class="fas fa-check-circle me-1"></i>Approve & Pay
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="5" class="text-center text-muted py-3">
                                No pending salaries to approve.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>
{% endblock %}