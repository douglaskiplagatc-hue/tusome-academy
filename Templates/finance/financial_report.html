{% extends "base.html" %}
{% block title %}Financial Report{% endblock %}

{% block extra_css %}
<style>
    /* Card shadows and rounding */
    .card {
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    /* Table header styling */
    thead {
        background-color: #5563DE;
        color: white;
    }

    /* Responsive cards for totals */
    .totals-card {
        min-width: 200px;
        flex: 1;
    }

    .totals-card h4 {
        font-weight: 600;
    }

    /* Badge styling */
    .badge-status {
        font-size: 0.9rem;
        padding: 0.35em 0.7em;
    }

    /* Space below sections */
    .section {
        margin-bottom: 2rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid mt-4">

    <h2 class="mb-4">
        <i class="fas fa-chart-line"></i> Financial Report - {{ current_year }}
    </h2>

    <!-- Totals Row -->
    <div class="d-flex flex-wrap gap-3 section">
        <div class="card totals-card p-3 text-center bg-primary text-white">
            <h4>Total Fees Billed</h4>
            <p class="fs-4">KES {{ (total_billed or 0) | round(2) }}</p>
        </div>
        <div class="card totals-card p-3 text-center bg-success text-white">
            <h4>Total Collected</h4>
            <p class="fs-4">{{ (total_collected or 0) | round(2) }}</p>
        </div>
        <div class="card totals-card p-3 text-center bg-warning text-dark">
            <h4>Total Outstanding</h4>
            <p class="fs-4">{{ (total_outstanding or 0) | round(2) }}</p>
        </div>
        <div class="card totals-card p-3 text-center bg-info text-white">
            <h4>Total Students</h4>
            <p class="fs-4">{{ total_students }}</p>
        </div>
    </div>

    <!-- Overdue Fees -->
    <div class="card section">
        <div class="card-header bg-danger text-white">
            <i class="fas fa-exclamation-circle"></i> Overdue Fee Alerts
        </div>
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-0">
                <thead>
                    <tr>
                        <th>Student</th>
                        <th>Parent</th>
                        <th>Balance</th>
                        <th>Due Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% if overdue_fees %}
                        {% for f in overdue_fees %}
                            <tr>
                                <td>{{ f.student.full_name }}</td>
                                <td>{{ f.student.parent.full_name }}</td>
                                <td>{{ ((f.amount_due or 0) - (f.total_paid or 0)) | round(2) }}</td>
                                <td>{{ f.due_date.strftime("%d %b %Y") }}</td>
                            </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="4" class="text-center">No overdue fees</td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Salaries -->
    <div class="card section">
        <div class="card-header bg-secondary text-white">
            <i class="fas fa-wallet"></i> Salary Overview
        </div>
        <div class="card-body">
            <div class="row text-center mb-3">
                <div class="col-md-3">
                    <div class="card p-2 bg-primary text-white">
                        <h6>Total Salary Budget</h6>
                        <p>{{ (total_salary_budget or 0) | round(2) }}</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card p-2 bg-success text-white">
                        <h6>Total Paid</h6>
                        <p>{{ (total_salary_paid or 0) | round(2) }}</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card p-2 bg-info text-white">
                        <h6>Academic Salaries</h6>
                        <p>{{ (academic_salaries or 0) | round(2) }}</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card p-2 bg-warning text-dark">
                        <h6>Admin Salaries</h6>
                        <p>{{ (admin_salaries or 0) | round(2) }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
{% endblock %}